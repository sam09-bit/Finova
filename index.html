<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finova - AI Stock Analysis</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000; /* Black */
            color: #f8fafc; /* slate-50 */
            overflow: hidden; /* Prevent scrolling during splash/sidebar open */
        }
        /* Container for the main app, hidden initially */
        #app-container {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            transition-delay: 0.5s;
        }
        /* Splash screen styles */
        #splash-screen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #000000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 0.5s ease-out 2.5s; /* Start fading out at 2.5s */
        }
        #splash-logo-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.8s cubic-bezier(0.6, 0, 0.2, 1);
        }
        #splash-logo {
            width: 288px; /* Approx 3 inches */
            height: 288px; /* Approx 3 inches */
        }
        #splash-text {
            font-size: 3.75rem; /* Larger text */
            font-weight: 700;
            color: white;
            margin-top: 20rem; /* Pushes text below the larger logo */
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }
        .sidebar-link.active {
            background-color: #059669; /* emerald-600 */
            color: white;
        }
        .loader {
            border: 4px solid #475569; /* slate-600 */
            border-top: 4px solid #10b981; /* emerald-500 */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .analysis-card {
            background-color: #1e293b; /* slate-800 */
            border: 1px solid #334155; /* slate-700 */
            border-radius: 0.75rem;
            padding: 1.5rem;
        }
        .analysis-card h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }
        .analysis-card h3 i {
            margin-right: 0.75rem;
            color: #22d3ee; /* cyan-400 */
        }
        .analysis-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid #334155; /* slate-700 */
        }
        .analysis-item:last-child {
            border-bottom: none;
        }
        .analysis-key {
            color: #94a3b8; /* slate-400 */
            font-weight: 500;
            text-transform: capitalize;
        }
        .analysis-value {
            color: #e2e8f0; /* slate-200 */
            font-weight: 600;
            text-align: right;
        }
        /* Hide scrollbar but allow scrolling */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>

    <!-- Splash Screen -->
    <div id="splash-screen">
        <div id="splash-logo-container">
            <img id="splash-logo" src="C:\Users\s7730\Finova\image.png" alt="Finova Logo">
        </div>
        <h1 id="splash-text">Finova</h1>
    </div>

    <!-- Main App Container -->
    <div id="app-container" class="relative min-h-screen bg-black">
        <!-- Sidebar Overlay -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black/60 z-30 hidden"></div>
        
        <!-- Sidebar -->
        <nav id="sidebar" class="fixed inset-y-0 left-0 w-64 bg-slate-900 border-r border-slate-800 flex-shrink-0 transform -translate-x-full transition-transform duration-300 ease-in-out z-40">
            <div id="sidebar-header" class="p-4 h-[72px] flex items-center">
                <img id="sidebar-logo" src="C:\Users\s7730\Finova\Screenshot_2025-10-05_185637-removebg-preview.png" alt="Finova Logo" class="w-8 h-8 mr-3 opacity-0"> <!-- Hidden until animation target is needed -->
                <h1 class="text-2xl font-bold text-white">Finova</h1>
            </div>
            <ul>
                <li>
                    <a href="#dashboard" class="sidebar-link active block p-4 text-slate-300 hover:bg-slate-700 flex items-center">
                        <i class="fas fa-tachometer-alt w-6 mr-2"></i> Dashboard
                    </a>
                </li>
                <li>
                    <a href="#analysis" class="sidebar-link block p-4 text-slate-300 hover:bg-slate-700 flex items-center">
                        <i class="fas fa-search-dollar w-6 mr-2"></i> Stock Analysis
                    </a>
                </li>
                <li>
                    <a href="#risk" class="sidebar-link block p-4 text-slate-300 hover:bg-slate-700 flex items-center">
                        <i class="fas fa-shield-alt w-6 mr-2"></i> Risk & Comparison
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 transition-all duration-300">
            <!-- Header for ALL screens -->
            <div class="sticky top-0 z-20 flex items-center justify-between p-4 bg-slate-900/80 backdrop-blur-sm">
                 <button id="sidebar-toggle" class="text-white p-2">
                     <i id="menu-open-icon" class="fas fa-bars fa-lg"></i>
                     <i id="menu-close-icon" class="fas fa-times fa-lg hidden"></i>
                 </button>
                 <h1 class="text-xl font-bold text-white lg:hidden">Finova</h1>
            </div>

            <div id="main-content-pages" class="overflow-y-auto">
                <!-- PAGE: Dashboard -->
                <section id="page-dashboard" class="p-4 md:p-8">
                    <h1 class="text-3xl font-bold mb-6">Dashboard</h1>
                    
                    <!-- Global Markets -->
                    <div class="mb-8">
                        <h2 class="text-2xl font-semibold mb-4">Global Markets</h2>
                        <div id="globalMarkets" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                            <div class="loader-container flex justify-center items-center col-span-full h-32">
                                <div class="loader"></div>
                            </div>
                        </div>
                    </div>
    
                    <!-- Daily Recommendations -->
                    <div>
                        <h2 class="text-2xl font-semibold mb-4">Daily Recommendations</h2>
                        <div id="dailyRecommendations" class="bg-slate-800 rounded-lg shadow-lg overflow-hidden border border-slate-700">
                            <div class="loader-container flex justify-center items-center h-48">
                                <div class="loader"></div>
                            </div>
                        </div>
                    </div>
                </section>
    
                <!-- PAGE: Stock Analysis -->
                <section id="page-analysis" class="p-4 md:p-8 hidden">
                    <div class="container mx-auto max-w-5xl">
                        <header class="text-center mb-8">
                            <h1 class="text-4xl md:text-5xl font-bold text-white">Stock Analysis</h1>
                            <p class="text-slate-400 mt-2">Get a comprehensive analysis of a stock using multiple metrics.</p>
                        </header>
                        <main>
                            <div class="bg-slate-800 p-6 rounded-xl shadow-lg border border-slate-700 mb-8">
                                <div class="flex flex-col sm:flex-row gap-4">
                                    <input type="text" id="tickerInput" placeholder="e.g., RELIANCE.NS, TSLA" class="flex-grow bg-slate-700 text-white placeholder-slate-400 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition duration-200">
                                    <button id="analyzeBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200 shadow-md flex items-center justify-center">
                                        <span>Analyze</span>
                                        <i class="fas fa-chart-line ml-2"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="resultsSection" class="hidden">
                                <div id="loader" class="flex justify-center items-center py-8 hidden"></div>
                                <div id="error" class="text-red-400 text-center py-4 hidden bg-slate-800 rounded-xl p-4"></div>
                                <div id="analysisContainer" class="hidden">
                                    <h2 id="analysisHeader" class="text-3xl font-bold text-white mb-6 text-center"></h2>
                                    <div id="analysisContent" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                                </div>
                            </div>
                        </main>
                    </div>
                </section>
    
                <!-- PAGE: Risk & Comparison -->
                <section id="page-risk" class="p-4 md:p-8 hidden">
                    <div class="container mx-auto max-w-6xl">
                        <h1 class="text-3xl font-bold mb-8">Risk & Comparison</h1>
    
                        <!-- Risk Analysis Section -->
                        <div class="bg-slate-800 border border-slate-700 rounded-xl p-6 mb-8">
                            <h2 class="text-2xl font-semibold mb-4">Risk Analysis</h2>
                            <p class="text-slate-400 mb-4">Enter your portfolio and prediction details to calculate risk metrics.</p>
                            <div class="space-y-4">
                                <div class="flex flex-col sm:flex-row gap-4">
                                    <input type="text" id="riskTickerInput" placeholder="Enter one stock symbol (e.g., AAPL)" class="flex-grow bg-slate-700 text-white placeholder-slate-400 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition duration-200">
                                    <input type="number" id="riskPortfolioValueInput" placeholder="Portfolio Value ($)" class="w-full sm:w-1/3 bg-slate-700 text-white placeholder-slate-400 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition duration-200">
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                    <input type="number" id="riskCurrentPriceInput" placeholder="Current Price" class="bg-slate-700 text-white placeholder-slate-400 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition duration-200">
                                    <input type="number" id="riskPredictedPriceInput" placeholder="Predicted Price" class="bg-slate-700 text-white placeholder-slate-400 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition duration-200">
                                    <input type="number" id="riskConfidenceInput" placeholder="Confidence (0-100)" class="bg-slate-700 text-white placeholder-slate-400 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition duration-200">
                                </div>
                                <div class="flex justify-end">
                                    <button id="riskAnalyzeBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200 shadow-md flex items-center justify-center">
                                        <span>Analyze Risk</span>
                                        <i class="fas fa-shield-alt ml-2"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="riskResultsSection" class="mt-6 hidden">
                                <div id="riskLoader" class="flex justify-center items-center py-8 hidden"></div>
                                <div id="riskError" class="text-red-400 text-center py-4 hidden bg-slate-900 rounded-lg p-4"></div>
                                <div id="riskContent" class="hidden"></div>
                            </div>
                        </div>
    
                        <!-- Stock Comparison Section -->
                        <div class="bg-slate-800 border border-slate-700 rounded-xl p-6">
                            <h2 class="text-2xl font-semibold mb-4">Compare Stocks</h2>
                            <div class="flex flex-col sm:flex-row gap-4">
                                <input type="text" id="compareTickerInput" placeholder="Enter multiple symbols, comma-separated (e.g., MSFT, GOOGL, AMZN)" class="flex-grow bg-slate-700 text-white placeholder-slate-400 border border-slate-600 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition duration-200">
                                <button id="compareBtn" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200 shadow-md flex items-center justify-center">
                                    <span>Compare</span>
                                    <i class="fas fa-balance-scale ml-2"></i>
                                </button>
                            </div>
                             <div id="compareResultsSection" class="mt-6 hidden">
                                <div id="compareLoader" class="flex justify-center items-center py-8 hidden"></div>
                                <div id="compareError" class="text-red-400 text-center py-4 hidden bg-slate-900 rounded-lg p-4"></div>
                                <div id="compareContent" class="hidden overflow-x-auto"></div>
                            </div>
                        </div>
    
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Splash Screen & Animation Logic ---
            const splashScreen = document.getElementById('splash-screen');
            const splashLogoContainer = document.getElementById('splash-logo-container');
            const splashText = document.getElementById('splash-text');
            const appContainer = document.getElementById('app-container');
            const sidebarLogo = document.getElementById('sidebar-logo');

            setTimeout(() => {
                const sidebarLogoRect = sidebarLogo.getBoundingClientRect();
                const splashLogoRect = splashLogoContainer.getBoundingClientRect();
                const deltaX = sidebarLogoRect.left - splashLogoRect.left;
                const deltaY = sidebarLogoRect.top - splashLogoRect.top;
                const scale = sidebarLogoRect.width / splashLogoRect.width;
                
                splashText.style.opacity = '0';

                setTimeout(() => {
                    splashLogoContainer.style.transform = `translate(${deltaX}px, ${deltaY}px) scale(${scale})`;
                }, 400); 

            }, 1500); 

            setTimeout(() => {
                splashScreen.style.opacity = '0';
                appContainer.style.opacity = '1';
                sidebarLogo.style.opacity = '1'; 
                document.body.style.overflow = 'auto';
            }, 2500); 

            setTimeout(() => {
                if(splashScreen) {
                   splashScreen.remove();
                }
            }, 3000); 


            // --- DOM Element References ---
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const menuOpenIcon = document.getElementById('menu-open-icon');
            const menuCloseIcon = document.getElementById('menu-close-icon');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const sidebarLinks = document.querySelectorAll('.sidebar-link');
            const pages = {
                'dashboard': document.getElementById('page-dashboard'),
                'analysis': document.getElementById('page-analysis'),
                'risk': document.getElementById('page-risk')
            };
            
            // Dashboard Elements
            const globalMarketsContainer = document.getElementById('globalMarkets');
            const dailyRecsContainer = document.getElementById('dailyRecommendations');

            // Analysis Elements
            const tickerInput = document.getElementById('tickerInput');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const resultsSection = document.getElementById('resultsSection');
            const loader = document.getElementById('loader');
            const errorDiv = document.getElementById('error');
            const analysisContainer = document.getElementById('analysisContainer');
            const analysisHeader = document.getElementById('analysisHeader');
            const analysisContent = document.getElementById('analysisContent');

            // Risk & Comparison Elements
            const riskAnalyzeBtn = document.getElementById('riskAnalyzeBtn');
            const riskResultsSection = document.getElementById('riskResultsSection');
            const riskLoader = document.getElementById('riskLoader');
            const riskError = document.getElementById('riskError');
            const riskContent = document.getElementById('riskContent');
            const compareBtn = document.getElementById('compareBtn');
            const compareResultsSection = document.getElementById('compareResultsSection');
            const compareLoader = document.getElementById('compareLoader');
            const compareError = document.getElementById('compareError');
            const compareContent = document.getElementById('compareContent');

            // --- State ---
            let isDashboardDataLoaded = false;
            
            // --- Sidebar Toggle Logic ---
            function toggleSidebar() {
                sidebar.classList.toggle('-translate-x-full');
                sidebarOverlay.classList.toggle('hidden');
                menuOpenIcon.classList.toggle('hidden');
                menuCloseIcon.classList.toggle('hidden');
                const isSidebarOpen = !sidebar.classList.contains('-translate-x-full');
                document.body.style.overflow = isSidebarOpen ? 'hidden' : 'auto';
            }

            sidebarToggle.addEventListener('click', toggleSidebar);
            sidebarOverlay.addEventListener('click', toggleSidebar);


            // --- Page Navigation Logic ---
            function showPage(pageId) {
                Object.values(pages).forEach(page => {
                    if(page) page.style.display = 'none';
                });
                if (pages[pageId]) {
                    pages[pageId].style.display = 'block';
                }
                sidebarLinks.forEach(link => {
                    link.classList.toggle('active', link.getAttribute('href') === `#${pageId}`);
                });
                if (pageId === 'dashboard' && !isDashboardDataLoaded) {
                    fetchAndDisplayDashboardData();
                }
            }

            sidebarLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = link.getAttribute('href').substring(1);
                    window.location.hash = pageId;
                    showPage(pageId);
                    // Close sidebar after navigation on any screen size
                    if (!sidebar.classList.contains('-translate-x-full')) {
                        toggleSidebar();
                    }
                });
            });

            const initialPage = window.location.hash ? window.location.hash.substring(1) : 'dashboard';
            showPage(initialPage);
            
            // --- Helper Functions ---
            function createAnalysisCard(title, content) {
                const card = document.createElement('div');
                card.className = 'analysis-card';
                let iconClass = 'fa-solid fa-chart-simple';
                if (title.toLowerCase().includes('summary')) iconClass = 'fa-solid fa-file-lines';
                if (title.toLowerCase().includes('financial')) iconClass = 'fa-solid fa-dollar-sign';
                if (title.toLowerCase().includes('technical')) iconClass = 'fa-solid fa-wave-square';
                if (title.toLowerCase().includes('risk')) iconClass = 'fa-solid fa-shield-alt text-cyan-400';
                
                card.innerHTML = `<h3><i class="${iconClass}"></i> ${title.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</h3>`;

                const createItem = (key, value) => {
                    let displayValue = value;
                    if (typeof displayValue === 'number' && displayValue > 1000000000) {
                        displayValue = new Date(displayValue * 1000).toLocaleDateString();
                    } else if (typeof displayValue === 'number') {
                        displayValue = displayValue.toLocaleString(undefined, { maximumFractionDigits: 2 });
                    }
                    if (displayValue === null || displayValue === undefined) displayValue = 'N/A';
                    
                    const lowerCaseValue = String(displayValue).toLowerCase();
                    let valueColorClass = '';
                    if (['buy', 'strong buy', 'positive', 'low risk'].includes(lowerCaseValue)) valueColorClass = 'text-green-400';
                    else if (['sell', 'strong sell', 'negative', 'high risk'].includes(lowerCaseValue)) valueColorClass = 'text-red-400';
                    
                    const item = document.createElement('div');
                    item.className = 'analysis-item';
                    item.innerHTML = `
                        <span class="analysis-key">${key.replace(/_/g, ' ')}</span>
                        <span class="analysis-value ${valueColorClass}">${displayValue}</span>
                    `;
                    return item;
                };

                for (const key in content) {
                    const value = content[key];
                    if (typeof value === 'object' && value !== null) {
                        for (const subKey in value) card.appendChild(createItem(`${key} ${subKey}`, value[subKey]));
                    } else {
                        card.appendChild(createItem(key, value));
                    }
                }
                return card;
            }

            function showError(element, message) {
                 element.textContent = `Error: ${message}`;
                 element.style.display = 'block';
            }

            function renderLoader(container) {
                container.innerHTML = `<div class="flex justify-center items-center h-32"><div class="loader"></div></div>`;
            }

            // --- Dashboard Logic ---
            async function fetchAndDisplayDashboardData() {
                isDashboardDataLoaded = true;
                console.log("Fetching dashboard data...");
                renderLoader(globalMarketsContainer);
                renderLoader(dailyRecsContainer);

                try {
                    const marketsResponse = await fetch('https://prishaa-stockpredictor.hf.space/api/global-markets');
                    if (!marketsResponse.ok) throw new Error('Failed to load market data.');
                    const marketsData = await marketsResponse.json();
                    console.log("Global Markets API response:", marketsData);
                    renderGlobalMarkets(marketsData);
                } catch (error) {
                    console.error("Global Markets API Error:", error);
                    globalMarketsContainer.innerHTML = `<p class="text-red-400 col-span-full text-center p-4">${error.message}</p>`;
                }

                try {
                    const recsResponse = await fetch('https://prishaa-stockpredictor.hf.space/api/daily-recommendations');
                    if (!recsResponse.ok) throw new Error('Failed to load recommendations.');
                    const recsData = await recsResponse.json();
                    console.log("Daily Recommendations API response:", recsData);
                    renderDailyRecommendations(recsData);
                } catch (error) {
                    console.error("Daily Recommendations API Error:", error);
                    dailyRecsContainer.innerHTML = `<p class="text-red-400 p-4 text-center">${error.message}</p>`;
                }
            }

            function renderGlobalMarkets(data) {
                globalMarketsContainer.innerHTML = '';
                const validEntries = Object.entries(data || {}).filter(([_, marketData]) => marketData && marketData.price);

                if (validEntries.length === 0) {
                    globalMarketsContainer.innerHTML = '<p class="text-center text-slate-400 p-4 col-span-full">No global market data available.</p>';
                    return;
                }

                validEntries.forEach(([market, marketData]) => {
                    const change = parseFloat(marketData.change);
                    const isPositive = change >= 0;
                    const card = document.createElement('div');
                    card.className = 'bg-slate-800 p-4 rounded-lg shadow-md border border-slate-700';
                    card.innerHTML = `
                        <h3 class="font-bold text-lg text-white">${market}</h3>
                        <p class="text-2xl font-semibold text-slate-200">${marketData.price}</p>
                        <div class="flex justify-between items-center mt-1 text-sm ${isPositive ? 'text-green-400' : 'text-red-400'}">
                            <span>${marketData.change} (${marketData.percent_change})</span>
                            <i class="fas ${isPositive ? 'fa-arrow-up' : 'fa-arrow-down'}"></i>
                        </div>
                    `;
                    globalMarketsContainer.appendChild(card);
                });
            }

            function renderDailyRecommendations(data) {
                dailyRecsContainer.innerHTML = '';
                const validRecs = Array.isArray(data) ? data.filter(rec => rec && rec.symbol && rec.action) : [];

                if (validRecs.length === 0) {
                    dailyRecsContainer.innerHTML = '<p class="text-center text-slate-400 p-4">No recommendations available today.</p>';
                    return;
                }

                const table = document.createElement('table');
                table.className = 'w-full text-left';
                table.innerHTML = `
                    <thead class="bg-slate-700">
                        <tr>
                            <th class="p-3">Symbol</th><th class="p-3">Action</th><th class="p-3 hidden sm:table-cell">Source</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${validRecs.map(rec => `
                            <tr class="border-b border-slate-700">
                                <td class="p-3 font-semibold">${rec.symbol}</td>
                                <td class="p-3">
                                    <span class="px-2 py-1 rounded-full text-xs font-bold ${
                                        rec.action.toLowerCase().includes('buy') ? 'bg-green-800 text-green-200' : 
                                        rec.action.toLowerCase().includes('sell') ? 'bg-red-800 text-red-200' :
                                        'bg-yellow-800 text-yellow-200'
                                    }">${rec.action}</span>
                                </td>
                                <td class="p-3 hidden sm:table-cell text-slate-400">${rec.source || 'N/A'}</td>
                            </tr>`).join('')}
                    </tbody>`;
                dailyRecsContainer.appendChild(table);
            }

            // --- Stock Analysis Logic ---
            async function handleAnalysis() {
                const ticker = tickerInput.value.trim();
                if (!ticker) {
                    showError(errorDiv, "Please enter a stock symbol.");
                    resultsSection.style.display = 'block';
                    return;
                }
                resultsSection.style.display = 'block';
                analysisContainer.style.display = 'none';
                errorDiv.style.display = 'none';
                renderLoader(loader);
                loader.style.display = 'block';

                try {
                    const response = await fetch('https://prishaa-stockpredictor.hf.space/api/analyze', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ symbol: ticker }),
                    });
                    const data = await response.json();
                    if (!response.ok) throw new Error(data.detail || `API request failed: ${response.status}`);
                    displayAnalysis(data, ticker.toUpperCase());
                } catch (error) {
                    showError(errorDiv, error.message);
                } finally {
                    loader.style.display = 'none';
                }
            }

            function displayAnalysis(data, symbol) {
                analysisContainer.style.display = 'block';
                analysisHeader.innerHTML = `Analysis for <span class="text-emerald-400">${symbol}</span>`;
                analysisContent.innerHTML = '';
                for (const key in data) {
                    if (typeof data[key] === 'object' && data[key] !== null) {
                        analysisContent.appendChild(createAnalysisCard(key, data[key]));
                    }
                }
            }
            
            analyzeBtn.addEventListener('click', handleAnalysis);
            tickerInput.addEventListener('keyup', (event) => { if (event.key === 'Enter') handleAnalysis(); });

            // --- Risk & Comparison Logic ---
            async function handleRiskAnalysis() {
                const ticker = document.getElementById('riskTickerInput').value.trim();
                const portfolioValue = parseFloat(document.getElementById('riskPortfolioValueInput').value);
                const currentPrice = parseFloat(document.getElementById('riskCurrentPriceInput').value);
                const predictedPrice = parseFloat(document.getElementById('riskPredictedPriceInput').value);
                const confidence = parseFloat(document.getElementById('riskConfidenceInput').value);
                
                riskResultsSection.style.display = 'block';
                riskContent.style.display = 'none';
                riskError.style.display = 'none';

                if (!ticker || isNaN(portfolioValue) || isNaN(currentPrice) || isNaN(predictedPrice) || isNaN(confidence)) {
                    showError(riskError, 'Please fill in all fields with valid numbers.');
                    return;
                }
                renderLoader(riskLoader);
                riskLoader.style.display = 'block';

                try {
                    const response = await fetch('https://prishaa-stockpredictor.hf.space/api/risk-analysis', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ symbol: ticker, current_price: currentPrice, predicted_price: predictedPrice, confidence: confidence, portfolio_value: portfolioValue }),
                    });
                    const data = await response.json();
                    if (!response.ok) throw new Error(data.detail || 'Failed to fetch risk analysis.');
                    renderRiskAnalysis(data, ticker.toUpperCase());
                } catch(error) {
                    showError(riskError, error.message);
                } finally {
                    riskLoader.style.display = 'none';
                }
            }

            function renderRiskAnalysis(data, symbol) {
                riskContent.innerHTML = '';
                riskContent.style.display = 'block';
                const card = createAnalysisCard(`Risk Metrics for ${symbol}`, data);
                riskContent.appendChild(card);
            }

            async function handleComparison() {
                const tickers = document.getElementById('compareTickerInput').value.split(',').map(t => t.trim().toUpperCase()).filter(Boolean);
                
                compareResultsSection.style.display = 'block';
                compareContent.style.display = 'none';
                compareError.style.display = 'none';

                if (tickers.length < 2) {
                    showError(compareError, 'Please enter at least two stock symbols to compare.');
                    return;
                };
                renderLoader(compareLoader);
                compareLoader.style.display = 'block';

                try {
                    const response = await fetch('https://prishaa-stockpredictor.hf.space/api/compare-stocks', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ symbols: tickers }),
                    });
                    const data = await response.json();
                    if (!response.ok) throw new Error(data.detail || 'Failed to fetch stock comparison.');
                    renderComparison(data);
                } catch(error) {
                    showError(compareError, error.message);
                } finally {
                    compareLoader.style.display = 'none';
                }
            }

            function renderComparison(data) {
                compareContent.innerHTML = '';
                compareContent.style.display = 'block';
                const symbols = Object.keys(data);
                if (symbols.length === 0) {
                    compareContent.innerHTML = '<p class="text-center text-slate-400 p-4">No comparison data available.</p>';
                    return;
                }
                const metrics = Object.keys(data[symbols[0]]);
                let tableHTML = `<table class="w-full text-left bg-slate-900 rounded-lg"><thead class="bg-slate-700"><tr><th class="p-3 sticky left-0 bg-slate-700 z-10">Metric</th>${symbols.map(s => `<th class="p-3 text-center">${s.toUpperCase()}</th>`).join('')}</tr></thead><tbody>`;
                metrics.forEach(metric => {
                    tableHTML += `<tr class="border-b border-slate-700"><td class="p-3 font-semibold text-slate-400 sticky left-0 bg-slate-800 z-10">${metric.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</td>${symbols.map(s => { let value = data[s][metric]; if (typeof value === 'number') { value = value.toLocaleString(undefined, { maximumFractionDigits: 2 }); } return `<td class="p-3 text-center">${value !== null && value !== undefined ? value : 'N/A'}</td>`; }).join('')}</tr>`;
                });
                tableHTML += `</tbody></table>`;
                compareContent.innerHTML = tableHTML;
            }

            riskAnalyzeBtn.addEventListener('click', handleRiskAnalysis);
            compareBtn.addEventListener('click', handleComparison);
        });
    </script>

</body>
</html>

